<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-GB" xml:lang="en-GB"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Eric Marcon">
<meta name="keywords" content="Fisher’s alpha, biodiversity, tropical forests">

<title>Fisher’s alpha is generally not a valid metric of biodiversity in tropical forests</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="index_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="index_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-b9aa03ad5355050647b5a7a5fe5b738e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="colors.css">
</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#material-and-methods" id="toc-material-and-methods" class="nav-link" data-scroll-target="#material-and-methods"><span class="header-section-number">2</span> Material and methods</a>
  <ul class="collapse">
  <li><a href="#fishers-alpha-fundamentals" id="toc-fishers-alpha-fundamentals" class="nav-link" data-scroll-target="#fishers-alpha-fundamentals"><span class="header-section-number">2.1</span> Fisher’s <span class="math inline">\(\alpha\)</span> fundamentals</a></li>
  <li><a href="#example-data" id="toc-example-data" class="nav-link" data-scroll-target="#example-data"><span class="header-section-number">2.2</span> Example data</a></li>
  </ul></li>
  <li><a href="#local-scale" id="toc-local-scale" class="nav-link" data-scroll-target="#local-scale"><span class="header-section-number">3</span> Local scale</a></li>
  <li><a href="#regional-scale" id="toc-regional-scale" class="nav-link" data-scroll-target="#regional-scale"><span class="header-section-number">4</span> Regional scale</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">5</span> Conclusion</a></li>
  
  
  <li><a href="#bibliography" id="toc-bibliography" class="nav-link" data-scroll-target="#bibliography">References</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.pdf"><i class="bi bi-file-pdf"></i>PDF (stylisharticle)</a></li></ul></div></nav>
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Fisher’s alpha is generally not a valid metric of biodiversity in tropical forests</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://ericmarcon.github.io/">Eric Marcon</a> <a href="mailto:eric.marcon@agroparistech.fr" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0002-5249-321X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            AgroParisTech
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    <p>Fisher’s alpha should not be used to assess the diversity of tropical forest tree species at the local and regional scales. At the local scale, communities are not distributed in log-series: alpha is the parameter of a model that does not fit the data so it can neither be estimated nor interpreted unambiguously. At the regional scale, alpha correctly describes the distribution of a metacommunity whose extent is unknown when it is not the whole forest area. Species richness is always a better diversity metric than alpha, containing basically the same information without relying on uncertain assumptions.</p>
  </div>
</div>

<div>
  <div class="keywords">
    <div class="block-title">Keywords</div>
    <p>Fisher’s alpha, biodiversity, tropical forests</p>
  </div>
</div>

</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Tropical evergreen forests such as the Amazon host thousand of tree species that are difficult to assess <span class="citation" data-cites="TerSteege2013">(<a href="#ref-TerSteege2013" role="doc-biblioref">Steege <em>et al.</em> 2013</a>)</span>. Even though their biodiversity does not reduce to trees, understanding their distribution is a necessary step to both understand the functioning of the ecosystem <span class="citation" data-cites="Liang2016">(<a href="#ref-Liang2016" role="doc-biblioref">Liang <em>et al.</em> 2016</a>)</span> and develop conservation policies <span class="citation" data-cites="Strange2024">(<a href="#ref-Strange2024" role="doc-biblioref">Strange <em>et al.</em> 2024</a>)</span>.</p>
<p>The relation between diversity and area has long been questioned by ecologists <span class="citation" data-cites="MacArthur1967 Plotkin2000a">(<a href="#ref-MacArthur1967" role="doc-biblioref">MacArthur &amp; Wilson 1967</a>; <a href="#ref-Plotkin2000a" role="doc-biblioref">Plotkin <em>et al.</em> 2000</a>)</span>. It must be addressed according to the considered scale <span class="citation" data-cites="Grilli2012">(<a href="#ref-Grilli2012" role="doc-biblioref">Grilli <em>et al.</em> 2012</a>)</span>. At the local scale, i.e.&nbsp;when the distribution of species can be considered as unique, species accumulation curves (SAC) are built from it with well-known statistical tools <span class="citation" data-cites="Gotelli2001 Chao2014">(<a href="#ref-Chao2014" role="doc-biblioref">Chao <em>et al.</em> 2014</a>; <a href="#ref-Gotelli2001" role="doc-biblioref">Gotelli &amp; Colwell 2001</a>)</span>. At regional scales, i.e.&nbsp;when different communities are included and beta-diversity comes into play, species-area relationships (SAR) properly speaking are derived from ecological theory <span class="citation" data-cites="Harte1999">(<a href="#ref-Harte1999" role="doc-biblioref">Harte <em>et al.</em> 1999</a>)</span> with empirical support <span class="citation" data-cites="Arrhenius1921">(<a href="#ref-Arrhenius1921" role="doc-biblioref">Arrhenius 1921</a>)</span>. Whatever the scale, the number species increases with the area or the number of individuals, making it a challenge to correctly describe biodiversity with a number: species richness (i.e.&nbsp;the number of species) is the simplest candidate, but its application may be ambiguous.</p>
<p>Fisher’s log-series <span class="citation" data-cites="Fisher1943">(<a href="#ref-Fisher1943" role="doc-biblioref">Fisher <em>et al.</em> 1943</a>)</span> was derived originally from a distribution of tropical butterflies. It is formulated as a species-abundance relationship that links the number of species to the number of individuals with a single parameter, called <span class="math inline">\(\alpha\)</span>. Fisher’s <span class="math inline">\(\alpha\)</span> is thus an ideal candidate to measure diversity since it overcomes the previous issue: it is scale-independent if the actual species distribution is a log-series. After a long period of relative obscurity, <span class="math inline">\(\alpha\)</span> made a comeback following the development of Hubbell’s neutral theory <span class="citation" data-cites="Hubbell2001">(<a href="#ref-Hubbell2001" role="doc-biblioref">Hubbell 2001</a>)</span> since the metacommunity is distributed in log-series whose <span class="math inline">\(\alpha\)</span> equals <span class="math inline">\(\theta\)</span>, the fundamental number of biodiversity. Although the log-series does not apply to the local scale according to the neutral theory, it became popular <span class="citation" data-cites="Duque2017 TerSteege2023">(<a href="#ref-Duque2017" role="doc-biblioref">Duque <em>et al.</em> 2017</a>; <a href="#ref-TerSteege2023" role="doc-biblioref">Ter Steege <em>et al.</em> 2023</a>)</span> to describe the diversity of forest trees, probably for its simplicity. Summarizing a species distribution by a statistics that does not apply to it is questionable. The aim of this paper is to show that <span class="math inline">\(\alpha\)</span> actually does not measure diversity unambiguously, neither at local nor at regional scales, and should be limited to the largest metacommunity. It is organised as follows: Fisher’s <span class="math inline">\(\alpha\)</span> fundamentals are first recalled; its use at the different scales is then discussed before concluding about its applicability.</p>
</section>
<section id="material-and-methods" class="level1 page-columns page-full" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Material and methods</h1>
<section id="fishers-alpha-fundamentals" class="level2 page-columns page-full" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="fishers-alpha-fundamentals"><span class="header-section-number">2.1</span> Fisher’s <span class="math inline">\(\alpha\)</span> fundamentals</h2>
<p>Fisher derived the log-series distribution from a set of assumptions <span class="citation" data-cites="Fisher1943">(<a href="#ref-Fisher1943" role="doc-biblioref">Fisher <em>et al.</em> 1943</a>)</span>. In his model, all species are distributed completely randomly and independently from each other, i.e.&nbsp;their abundance in a fixed area follows a Poisson distribution. The intensities of the Poisson distributions of all species follow in turn a gamma distribution with shape parameter (tending to) zero. Last, the number of species is infinite. Then, the number of species with non-zero abundance <span class="math inline">\(S(n)\)</span> is linked to the size of the community <span class="math inline">\(n\)</span> through <a href="#eq-fisheralpha" class="quarto-xref">Equation&nbsp;1</a> by a parameter named <span class="math inline">\(\alpha\)</span>. It is called log-series because the number of species is derived as the sum of the number of species any number of individuals: this infinite sum appears to be the Taylor series of the logarithm function.</p>
<p><span id="eq-fisheralpha"><span class="math display">\[
  S(n) = \alpha \ln \left( 1 + \frac{n}{\alpha} \right)
\tag{1}\]</span></span></p>
<p>For <span class="math inline">\(n \gg \alpha\)</span>, <a href="#eq-fisheralpha" class="quarto-xref">Equation&nbsp;1</a> can be simplified to <span class="math inline">\(S(n) \approx -\alpha ln(\alpha) + \alpha ln(n)\)</span>, i.e.&nbsp;the number of observed species is linearly related to the logarithm of the sample size. The slope of the line is <span class="math inline">\(\alpha\)</span> and the intercept is <span class="math inline">\(-\alpha ln(\alpha)\)</span>.</p>
<div id="fig-BCI_accum_logx" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-BCI_accum_logx-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/BCI_accum_logx-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p></p>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-BCI_accum_logx-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Species Accumulation Curve (SAC) of a log-series distribution (black) with Fisher’s <span class="math inline">\(\alpha\)</span> equal to 35 and of BCI (red). The intersection of the dotted lines corresponds to the number of trees and of species of BCI 50-ha inventory the value of <span class="math inline">\(\alpha\)</span> is derived from.
</figcaption>
</figure>
</div>
<p>Based on <a href="#eq-fisheralpha" class="quarto-xref">Equation&nbsp;1</a>, the species accumulation curve has two parts when plotted on a logarithmic x-axis: first, as <span class="math inline">\(n\)</span> is not great enough for the approximation, it is convex, then it is linear (<a href="#fig-BCI_accum_logx" class="quarto-xref">Figure&nbsp;1</a>).</p>
<p>The distribution can also be represented as a rank-abundance curve (RAC: <a href="#fig-BCI_RAC" class="quarto-xref">Figure&nbsp;2</a>). <span class="math inline">\(p_s\)</span> is the probability for an individual to belong to species <span class="math inline">\(s\)</span> and <span class="math inline">\(\{\mathbf{p}\} = \{p_1, p_2, \dots, p_s, \dots\}\)</span> is the set of species probabilities. The relative abundance of species <span class="math inline">\(s\)</span> estimates its probability: <span class="math inline">\(\hat{p}_s = n_s / n\)</span>, so <span class="math inline">\(\{\mathbf{\hat{p}}\}\)</span>, the empirical distribution, is an estimator of <span class="math inline">\(\{\mathbf{p}\}\)</span>, the actual species distribution. The RAC represents the (relative or absolute) abundances of observed species in decreasing order. A characteristic feature of the log-series is that the abundance of species decreases linearly with their rank, except for the most abundant ones. Rarer species are included in the RAC as <span class="math inline">\(n\)</span> increases.</p>
<div id="fig-BCI_RAC" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-BCI_RAC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/BCI_RAC-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p></p>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-BCI_RAC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Rank-Abundance Curve (RAC) of a log-series distribution (black) and of BCI (red dots). Species are ordered by decreasing abundance. The log-series is the best fit to BCI data (<span class="math inline">\(\alpha =\)</span> 35).
</figcaption>
</figure>
</div>
</section>
<section id="example-data" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="example-data"><span class="header-section-number">2.2</span> Example data</h2>
<p>To illustrate the estimation of Fisher’s <span class="math inline">\(\alpha\)</span> at the local scale, the BCI data set available in the R <span class="citation" data-cites="R">(<a href="#ref-R" role="doc-biblioref">R Core Team 2025</a>)</span> package vegan <span class="citation" data-cites="vegan">(<a href="#ref-vegan" role="doc-biblioref">Oksanen <em>et al.</em> 2025</a>)</span> will be used. It was published by <span class="citation" data-cites="Condit2002">Condit <em>et al.</em> (<a href="#ref-Condit2002" role="doc-biblioref">2002</a>)</span>. The data consist of 50 one-hectare plots of tropical evergreen forest where all trees above 10 cm DBH (diameter at breast height) were recorded. The forest is located on Barro Colorado Island in the canal of Panama. It has been studied by many authors <span class="citation" data-cites="Muller-Landau2024">(<a href="#ref-Muller-Landau2024" role="doc-biblioref">Muller-Landau &amp; Wright 2024</a>)</span>, allowing to compare the results of this paper to a large literature, even though the metrics of diversity may vary somehow since the forest was inventoried at different dates, including trees above 1 cm DBH. The BCI dataset used here contains 21457 trees above 10 cm DBH in 225 species.</p>
<p>The regional dataset is a part of the GuyaDiv network <span class="citation" data-cites="Engel2015">(<a href="#ref-Engel2015" role="doc-biblioref">Engel 2015</a>)</span> located in French Guiana, published in <span class="citation" data-cites="Marcon2024">Marcon <em>et al.</em> (<a href="#ref-Marcon2024" role="doc-biblioref">2024</a>)</span>. It contains 68 one-hectare plots located in 21 sites scattered over the territory. They were used to estimate the number of tree species in French Guiana: around 2200 in 80,000 km<sup>2</sup> of continuous, tropical evergreen forest on the north-eastern edge of the Amazon.</p>
</section>
</section>
<section id="local-scale" class="level1 page-columns page-full" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Local scale</h1>
<div id="fig-BCI_accum" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-BCI_accum-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/BCI_accum-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p></p>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-BCI_accum-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Species Accumulation Curve of BCI extrapolated up to twice the sample size. The dotted lines correspond to the 50-ha inventory. The horizontal, dotted line, is the estimated asymptotic number of species, calculated with the jackknife estimator of order 1. The black curve is the SAC of the log-series with <span class="math inline">\(\alpha\)</span> equal to 35.
</figcaption>
</figure>
</div>
<p>Sampling the local community results in a species accumulation curve, studied in depth by <span class="citation" data-cites="Gotelli2001">Gotelli &amp; Colwell (<a href="#ref-Gotelli2001" role="doc-biblioref">2001</a>)</span>. The number of species increases step by step, when the next sampled individual belongs to a new one. This stochastic <em>collector’s curve</em> is of less interest than its expectation, assuming individuals are sampled independently: only that smoothed curve is called the SAC. It is actually computed by rarefaction of the distribution of the whole sample <span class="citation" data-cites="Chao2014">(<a href="#ref-Chao2014" role="doc-biblioref">Chao <em>et al.</em> 2014</a>)</span>. It is usually plotted on continuous scales. Between sample sizes <span class="math inline">\(n\)</span> and <span class="math inline">\(n + 1\)</span>, the slope of the curve is the probability for the next individual to belong to a new species <span class="citation" data-cites="Grabchak2016">(<a href="#ref-Grabchak2016" role="doc-biblioref">Grabchak <em>et al.</em> 2017</a>)</span>: it decreases until all species have been discovered, so it is concave.</p>
<p><a href="#fig-BCI_accum" class="quarto-xref">Figure&nbsp;3</a> shows the SAC of the Barro Colorado Island 50-ha forest plot. The number of species increases with sample size and does not reach an asymptote despite the huge sampling effort. To allow comparing diversity with other sites, two strategies are possible: estimating asymptotic diversity or standardizing the sampling effort <span class="citation" data-cites="Chao2012b">(<a href="#ref-Chao2012b" role="doc-biblioref">Chao &amp; Jost 2012</a>)</span>.</p>
<p>The asymptotic diversity is the number of species that would be observed if the sample reached the necessary size to encompass all species of the community : it equals 244 according to the jackknife estimator <span class="citation" data-cites="Burnham1978">(<a href="#ref-Burnham1978" role="doc-biblioref">Burnham &amp; Overton 1978</a>)</span>. In hyperdiverse ecosystems such as evergreen forests, the asymptotic community generally does not exist in the field because of environmental variations: increasing the size of the sample results in sampling in different communities. Thus, the asymptotic estimators of diversity correspond to theoretical asymptotic communities that do not necessarily exist: it is a feature of a model. This may be an argument for avoiding them, but the definition of the local community is already a model <span class="citation" data-cites="Stroud2015">(<a href="#ref-Stroud2015" role="doc-biblioref">Stroud <em>et al.</em> 2015</a>)</span>, in the sense that local environmental variations imply that the distribution of species varies in turn: the neglected heterogeneity of what is defined as the local community corresponds to necessary decisions to model the reality.</p>
<p>The alternative consists in standardizing the sample size, in general to allow comparing different communities whose inventories are not large enough to allow a reliable estimation of asymptotic diversity. Exact rarefaction formulas are available to calculate the number of tree species at any sampling level smaller than the actual sample, and estimators allow extrapolating the diversity up to a limited level, around twice the actual sample size <span class="citation" data-cites="Chao2014">(<a href="#ref-Chao2014" role="doc-biblioref">Chao <em>et al.</em> 2014</a>)</span>. The expected number of species in one hectare of BCI, actually based on the average number of trees per hectare (equal to 429), is 103. This result can be compared easily to well-known benchmarks, such as the 367 species inventoried in one hectare of an Amazonian Ecuador forest <span class="citation" data-cites="Valencia1994">(<a href="#ref-Valencia1994" role="doc-biblioref">Valencia <em>et al.</em> 1994</a>)</span>, even though a larger area would be preferable to better take into account the rare species and leave the steepest part of the SAC in <a href="#fig-BCI_accum" class="quarto-xref">Figure&nbsp;3</a>.</p>
<p>In contrast, Fisher’s <span class="math inline">\(\alpha\)</span> does not depend on the sample size as soon as <span class="math inline">\(n \gg \alpha\)</span>, which is always true in forest inventories. Thus, it appears to be an ideal, universal metric of biodiversity, allowing to compare it across sites of different sizes. The issue is that the distribution of tropical forest tree communities is not a log-series. <span class="citation" data-cites="Hubbell2001">Hubbell (<a href="#ref-Hubbell2001" role="doc-biblioref">2001</a>)</span> named it the zero-sum multinomial distribution; its mathematical derivation is due to <span class="citation" data-cites="Volkov2003">Volkov <em>et al.</em> (<a href="#ref-Volkov2003" role="doc-biblioref">2003</a>)</span>. It is close to a log-normal distribution <span class="citation" data-cites="McGill2003">(<a href="#ref-McGill2003" role="doc-biblioref">McGill 2003</a>)</span>, but differs from by a greater abundance of the rarest species. This discrepancy has two consequences: from a theoretical point of view, <span class="math inline">\(\alpha\)</span> is the parameter of a distribution that is not observed; from an empirical point of view, its estimation is inconsistent.</p>
<p>The theoretical issue does not require much more argumentation. Applying an inappropriate model to describe the distribution of species is similar to trying to describe the size of a rectangle by its length, assuming it is a square.</p>
<p>The empirical question deserves further elaboration because it is always possible to estimate <span class="math inline">\(\alpha\)</span> from the data and implicitly assume log-series distributions. A basic argument is that the actual distribution is not so different from a log-series that the advantages of summarizing it by <span class="math inline">\(\alpha\)</span> are worth accepting the approximation. In an important article, <span class="citation" data-cites="TerSteege2023">Ter Steege <em>et al.</em> (<a href="#ref-TerSteege2023" role="doc-biblioref">2023</a>)</span> study the <span class="math inline">\(\alpha\)</span> diversity of tree species across the Amazon, defined as “Fisher’s alpha of a tree-inventory plot”. Historically, <span class="citation" data-cites="Whittaker1960">Whittaker (<a href="#ref-Whittaker1960" role="doc-biblioref">1960</a>)</span> named the average local diversity after Fisher’s <span class="math inline">\(\alpha\)</span>, but his metric was species richness. <span class="citation" data-cites="TerSteege2023">Ter Steege <em>et al.</em> (<a href="#ref-TerSteege2023" role="doc-biblioref">2023</a>)</span> revert the reference, declaring Fisher’s <span class="math inline">\(\alpha\)</span> the standard measure of <span class="math inline">\(\alpha\)</span> diversity. This shortcut must be discussed in depth.</p>
<p>Several R packages allow estimating <span class="math inline">\(\alpha\)</span> from a vector of abundances (see Appendix <a href="#sec-appendix1" class="quarto-xref">Section&nbsp;7.1</a> for details). Most of them (such as <code>vegan::fisher.alpha</code>) just solve <a href="#eq-fisheralpha" class="quarto-xref">Equation&nbsp;1</a>, i.e.&nbsp;they only rely on the total abundance and number of species, ignoring the distribution. This estimator will be denoted <span class="math inline">\(\hat\alpha(n, S)\)</span>: it corresponds to the intersection between the SACs of a log-series and of the data (<a href="#fig-BCI_accum" class="quarto-xref">Figure&nbsp;3</a>). Often, the sample size is an area <span class="math inline">\(A\)</span>, so the estimator is rather <span class="math inline">\(\hat\alpha(n(A), S)\)</span> where the number of individuals depends on the area. More elaborate functions (such as <code>sads::fitls</code>) find the value of <span class="math inline">\(\alpha\)</span> that maximizes the likelihood of the distribution assuming it is a log-series. That estimator will be denoted <span class="math inline">\(\hat\alpha_{MLE}(\{\mathbf{\hat{p}}\})\)</span>. A new estimator based on goodness of fit instead of likelihood maximization is proposed in Appendix <a href="#sec-appendix1" class="quarto-xref">Section&nbsp;7.1</a>: <span class="math inline">\(\hat\alpha_{gof}(\{\mathbf{\hat{p}}\})\)</span>.</p>
<p>When applied to the BCI dataset, both <span class="math inline">\(\hat\alpha(n, S)\)</span> and <span class="math inline">\(\hat\alpha_{MLE}(\{\mathbf{\hat{p}}\})\)</span> return the same estimation: 35. Its poor empirical fit is illustrated by <a href="#fig-BCI_accum" class="quarto-xref">Figure&nbsp;3</a> and <a href="#fig-BCI_accum_logx" class="quarto-xref">Figure&nbsp;1</a>. <span class="math inline">\(\hat\alpha_{gof}(\{\mathbf{\hat{p}}\})\)</span> better takes into account the rarer species (Appendix <a href="#fig-bci_alpha_gof" class="quarto-xref">Figure&nbsp;6</a>). It equals 42.</p>
<div id="fig-BCI_size" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-BCI_size-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/BCI_size-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p></p>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-BCI_size-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Estimation of Fisher’s <span class="math inline">\(\alpha\)</span> depending on the number of 1-ha plots of BCI. The dots are random draws of plot assemblages. The line is the fit of a linear model relating <span class="math inline">\(\alpha\)</span> to the logarithm of the number of plots.
</figcaption>
</figure>
</div>
<p>In contrast with the assumed advantage of <span class="math inline">\(\alpha\)</span>, its estimate <span class="math inline">\(\hat\alpha(n, S)\)</span> heavily relies on the sample size. <a href="#fig-BCI_size" class="quarto-xref">Figure&nbsp;4</a> shows the average estimation of <span class="math inline">\(\alpha\)</span> based on random subsamples of BCI, from 4 to 50ha, repeated 20 times. The estimated value of <span class="math inline">\(\alpha\)</span> decreases from over 40 to approximately 35, with a quite good linear relation between <span class="math inline">\(\alpha\)</span> and the logarithm of the sample size. Several studies can be found in the literature, e.g. <span class="citation" data-cites="Duque2017">Duque <em>et al.</em> (<a href="#ref-Duque2017" role="doc-biblioref">2017</a>)</span> and <span class="citation" data-cites="Schulte2005">Schulte <em>et al.</em> (<a href="#ref-Schulte2005" role="doc-biblioref">2005</a>)</span>, where the dependence of <span class="math inline">\(\alpha\)</span> to sample size is explored either with a statistical or an ecological approach. Actually, according to the definition of the SAC that reaches an asymptote, <span class="math inline">\(\hat\alpha(n, S) \to 0\)</span> when <span class="math inline">\(n \to \infty\)</span>. At this stage, there is no real argument to decide whether BCI’s <span class="math inline">\(\alpha\)</span> is 35 or 40, or even its asymptotic estimate equal to 0. The best choice is probably to consider that it is simply not defined.</p>
<p>A degraded utilization of <span class="math inline">\(\alpha\)</span>, more precisely <span class="math inline">\(\hat\alpha(n, S)\)</span>, would be legitimate if it allowed ordering communities <span class="citation" data-cites="Tothmeresz1995">(<a href="#ref-Tothmeresz1995" role="doc-biblioref">Tothmeresz 1995</a>)</span>, even though it does not qualify a log-series distribution. If the sample size <span class="math inline">\(n\)</span> is fixed, then a bijective relation exists between the estimate of <span class="math inline">\(\alpha\)</span> and the number of species <span class="math inline">\(S\)</span>, i.e.&nbsp;standardised richness. In this case, <span class="math inline">\(\hat\alpha(n, S)\)</span> is a valid, although uselessly complicated, index of diversity. But when the sampling effort is an area, <span class="math inline">\(n\)</span> varies. Everything else equal, <span class="math inline">\(S\)</span> increases with <span class="math inline">\(n\)</span> : this defines the SAC. The consequence of different tree density is thus unpredictable, since <span class="math inline">\(\hat\alpha(n, S)\)</span> is an increasing function of <span class="math inline">\(S\)</span> but a decreasing function of <span class="math inline">\(n\)</span>. In a log-series distribution, <span class="math inline">\(S\)</span> and <span class="math inline">\(n\)</span> neutralise each other so that <span class="math inline">\(\alpha\)</span> is constant, but other distributions entangle their effects. Two communities with the same species distributions, whose diversites are by definition equal <span class="citation" data-cites="Patil1982">(<a href="#ref-Patil1982" role="doc-biblioref">Patil &amp; Taillie 1982</a>)</span>, may be ordered differently if their densities vary.</p>
<p>A workaround for these problems is assuming that the local community is a sample of the metacommunity, following the neutral theory. It is not a log-series only because of dispersal limitation, i.e.&nbsp;its migration parameter <span class="math inline">\(m\)</span> is not 1. Then, the parameter to estimate is <span class="math inline">\(\theta\)</span>, the fundamental number of biodiversity in the metacommunity BCI belongs to. Increasing the sample size does not lead to reach the asymptotic, local diversity but (because the modelling choice is different) makes the distribution converge to that of the metacommunity: <span class="math inline">\(\hat\alpha(\{\mathbf{\hat{p}\}}) \to \hat\alpha(\{\mathbf{p}\}) = \theta\)</span> when <span class="math inline">\(n \to \infty\)</span>. This is an elegant solution both theoretically (all assumptions are valid) and empirically (the estimation of <span class="math inline">\(\theta\)</span> is unbiased).</p>
<p><span class="citation" data-cites="Hubbell2001">Hubbell (<a href="#ref-Hubbell2001" role="doc-biblioref">2001</a>)</span> [page 293] proposed estimating <span class="math inline">\(\theta\)</span> by adjusting the rank-abundance curve to the most frequent species in the community, arguing that these species are also the most abundant in the metacommunity. He found <span class="math inline">\(\theta = 50\)</span>. The same algorithm is applied to the current BCI dataset in Appendix <a href="#sec-appendix2" class="quarto-xref">Section&nbsp;7.2</a>: its result is <span class="math inline">\(\theta = 45\)</span>. More robustly, both <span class="math inline">\(\theta\)</span> and <span class="math inline">\(m\)</span> can be estimated by likelihood maximization of the local distribution <span class="citation" data-cites="Etienne2005">(<a href="#ref-Etienne2005" role="doc-biblioref">Etienne 2005</a>)</span> with the untb package <span class="citation" data-cites="Hankin2007">(<a href="#ref-Hankin2007" role="doc-biblioref">Hankin 2007</a>)</span>. The retained value of <span class="math inline">\(\theta\)</span> is 48. The consistency of this approach is shown in Appendix <a href="#sec-appendix3" class="quarto-xref">Section&nbsp;7.3</a>: <span class="math inline">\(\theta\)</span> and <span class="math inline">\(m\)</span> are estimated from the BCI distribution, then a community of the same size is drawn with these parameters: it is very close to the actual distribution.</p>
<p>This approach faces two limits. As far as we know, it is not applied in the literature: the metric of <span class="citation" data-cites="TerSteege2023">Ter Steege <em>et al.</em> (<a href="#ref-TerSteege2023" role="doc-biblioref">2023</a>)</span> is <span class="math inline">\(\hat\alpha(n(1\ \mathrm{ha}), S)\)</span>, not <span class="math inline">\(\theta\)</span>. More importantly, it does not describe the diversity of the local community but that of the metacommunity: summarizing BCI by <span class="math inline">\(\theta = 48\)</span> ignores the migration parameter. Modifying <span class="math inline">\(m\)</span> yields very different distributions, from geometric to log-series <span class="citation" data-cites="Hubbell2001">(<a href="#ref-Hubbell2001" role="doc-biblioref">Hubbell 2001</a>)</span>. In other words, <span class="math inline">\(\theta\)</span> only gives a very partial knowledge of the diversity of the local community.</p>
</section>
<section id="regional-scale" class="level1 page-columns page-full" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Regional scale</h1>
<p>The regional scale is that of Arrhenius’s model <span class="citation" data-cites="Arrhenius1921">(<a href="#ref-Arrhenius1921" role="doc-biblioref">Arrhenius 1921</a>)</span>. Its fundamental difference with the local scale is that several communities are taken into account, involving <span class="math inline">\(\beta\)</span> diversity that can’t be addressed directly. Whereas the computation of the local species accumulation curve was non-parametric, based solely on statistical techniques, the regional species-area relationship follows a power model with parameters <span class="math inline">\(c\)</span> and <span class="math inline">\(z\)</span> ,</p>
<p><span id="eq-arrhenius"><span class="math display">\[
  S(A) =c A^z,
\tag{2}\]</span></span></p>
<p>where <span class="math inline">\(A\)</span> is the surface area, <span class="math inline">\(c\)</span> a constant that depends on the organisms taken into account and the regional diversity, and <span class="math inline">\(z\)</span> the parameter that relates richness to area. Assuming that forest communities are saturated <span class="citation" data-cites="Hubbell2001">(<a href="#ref-Hubbell2001" role="doc-biblioref">Hubbell 2001</a>)</span>, i.e.&nbsp;<span class="math inline">\(n = \rho A\)</span> where <span class="math inline">\(\rho\)</span> is the number of trees per unit area, the number of individuals is proportional to the area, and, since <span class="math inline">\(\ln n \gg \ln \rho\)</span>, the model can be rewritten in a linear form:</p>
<p><span id="eq-arrhenius_log"><span class="math display">\[
  \ln\left(S\left(n\right)\right) = k_A + z \ln\left(n\right)
\tag{3}\]</span></span></p>
<p>where <span class="math inline">\(k_A\)</span> is another constant.</p>
<p>The regional scale is also that of the metacommunity in the neutral model. The actual size <span class="math inline">\(J_m\)</span> of the metacommunity a local community results from is difficult to address and of little interest in the theory since the important parameter is <span class="math inline">\(\theta\)</span>, that combines both <span class="math inline">\(J_m\)</span> and the speciation rate <span class="math inline">\(\nu\)</span>. The important fact here is that, according to the neutral model, metacommunities are distributed in log-series whose <span class="math inline">\(\alpha\)</span> parameter asymptotically tends to <span class="math inline">\(\theta\)</span> when their size increases <span class="citation" data-cites="Hubbell2001">(<a href="#ref-Hubbell2001" role="doc-biblioref">Hubbell 2001</a>)</span>.</p>
<p>Sampling the metacommunity by a large enough number of plots results in a log-series distribution. This property allowed estimating the number of species of the Amazon forest <span class="citation" data-cites="TerSteege2013">(<a href="#ref-TerSteege2013" role="doc-biblioref">Steege <em>et al.</em> 2013</a>)</span> and of all tropical forests of the world <span class="citation" data-cites="Slik2015">(<a href="#ref-Slik2015" role="doc-biblioref">Slik <em>et al.</em> 2015</a>)</span>. Discussing the sampling issues due to the spatial structure of species <span class="citation" data-cites="TerSteege2020">(<a href="#ref-TerSteege2020" role="doc-biblioref">Steege <em>et al.</em> 2020</a>)</span> or the discrepancies between the empirical and theoretical distributions <span class="citation" data-cites="Milton2025">(<a href="#ref-Milton2025" role="doc-biblioref">Milton &amp; Ostling 2025</a>)</span> is not the scope of this paper: even ignoring them, the theory is very well supported empirically.</p>
<p><span class="citation" data-cites="Gleason1922">Gleason (<a href="#ref-Gleason1922" role="doc-biblioref">1922</a>)</span> refuted Arrhenius’s model, arguing that the richness would be far too high for large areas, and proposed a competing model in which the number of species, rather than its logarithm, increased with the logarithm of the area. Assuming saturation, it can be rewritten as</p>
<p><span id="eq-gleason_log"><span class="math display">\[
   S\left(n\right) = k_G + \alpha \ln\left(n\right),
\tag{4}\]</span></span></p>
<p>where <span class="math inline">\(k_G\)</span> is yet another constant and <span class="math inline">\(\alpha\)</span> the slope of the relation. This model is actually identical to Fisher’s <span class="citation" data-cites="Engen1977">(<a href="#ref-Engen1977" role="doc-biblioref">Engen 1977</a>)</span>.</p>
<p>Arrhenius’s model benefits from a long theoretical <span class="citation" data-cites="Williamson2001 Harte1999 Preston1962">(<a href="#ref-Harte1999" role="doc-biblioref">Harte <em>et al.</em> 1999</a>; <a href="#ref-Preston1962" role="doc-biblioref">Preston 1962</a>; <a href="#ref-Williamson2001" role="doc-biblioref">Williamson <em>et al.</em> 2001</a>)</span> and empirical <span class="citation" data-cites="Dengler2009 Triantis2012">(<a href="#ref-Dengler2009" role="doc-biblioref">Dengler 2009</a>; <a href="#ref-Triantis2012" role="doc-biblioref">Triantis <em>et al.</em> 2012</a>)</span> support. A simple argument against Gleason’s model is contained in the neutral theory. Consider a large metacommunity and assume it is distributed as a log-series. A smaller metacommunity inside it would just be a sample of it in absence of dispersal limitation. Then both distributions would be identical, i.e.&nbsp;the same log-series with the same parameter <span class="math inline">\(\alpha\)</span>: the same Fisher’s model would be valid for all subsamples of the largest metacommunity, validating Gleason’s model. Yet, dispersal is limited, i.e.&nbsp;not all species of the largest metacommunity are present in the smaller ones: their diversity is reduced. Although they are distributed in log-series, their parameter <span class="math inline">\(\alpha\)</span> is smaller. Thus, the number of species decreases faster with the area than predicted by Gleason’s model, inverting his original argument.</p>
<p>At this stage, we face an apparent paradox: the regional species-area relationship follows a power model but a metacommunity is distributed in log-series. It is solved considering that the metacommunity’s <span class="math inline">\(\alpha\)</span> parameter depends on its size. Again, a smaller metacommunity embedded in the first one does not contain all species because of dispersal limitation.</p>
<p>When the SAR is plotted on a log-log scale, it is linear (<a href="#eq-arrhenius_log" class="quarto-xref">Equation&nbsp;3</a>). If the y-axis is not in logarithmic scale, it becomes convex. In this representation (<a href="#fig-arrhenius_logx" class="quarto-xref">Figure&nbsp;5</a>), a log-series species accumulation curve is a straight line (the number of individuals is much greater than <span class="math inline">\(\alpha\)</span>). This theoretical result can be verified empirically with the GuyaDiv network plots in French Guiana (Appendix <a href="#sec-appendix4" class="quarto-xref">Section&nbsp;7.4</a>): <span class="math inline">\(\alpha\)</span> increases with the number of sites included in the sample.</p>
<div id="fig-arrhenius_logx" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-arrhenius_logx-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/arrhenius_logx-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p></p>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-arrhenius_logx-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Number of tree species depending on the area (in square km, with density 627 trees/ha) in French Guiana, according to the Arrhenius’s power model estimated by <span class="citation" data-cites="Marcon2024">Marcon <em>et al.</em> (<a href="#ref-Marcon2024" role="doc-biblioref">2024</a>)</span>. The Y-axis is not in logarithm, so the relation is a convex curve instead of a straight line. The black dotted lines show the valid estimation of richness in the whole territory: around 2200 species for 80,000 km<sup>2</sup>. The blue line is the species accumulation curve of the log-series estimated from the GuyaDiv metacommunity assuming its area is that of French Guiana. It overestimates the regional biodiversity at all scales. The red curve is the SAC of the actual metacommunity of French Guiana, whose Fisher’s <span class="math inline">\(\alpha\)</span> is twice smaller.
</figcaption>
</figure>
</div>
<p>The metacommunity GuyaDiv is a sample of largely exceeds the borders of French Guiana. Its estimated <span class="math inline">\(\alpha\)</span> equals 257, implying more than 4000 tree species in the territory based on the number of trees: 627 per hectare on average multiplied by 8 million hectares. Its SAC is shown in <a href="#fig-arrhenius_logx" class="quarto-xref">Figure&nbsp;5</a>. The actual number of species in French Guiana was obtained by the estimation of the power model <span class="citation" data-cites="Marcon2024">(<a href="#ref-Marcon2024" role="doc-biblioref">Marcon <em>et al.</em> 2024</a>)</span>: it is close to 2200. The correct estimate of <span class="math inline">\(\alpha\)</span> is thus only 128.</p>
<p>This example illustrates the impossibility to estimate <span class="math inline">\(\alpha\)</span> at a regional scale from sample plots, e.g.&nbsp;to compare the diversity of adjacent regions. Log-series can be sampled, but the size of the metacommunities can’t be controlled. Of course, this issue vanishes when the metacommunity under study is bounded, e.g.&nbsp;the Amazon sampled by <span class="citation" data-cites="TerSteege2013">Steege <em>et al.</em> (<a href="#ref-TerSteege2013" role="doc-biblioref">2013</a>)</span> to estimate its total number of species. In this case, adding samples necessarily leads to an asymptotic estimation of <span class="math inline">\(\alpha\)</span>.</p>
</section>
<section id="conclusion" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Conclusion</h1>
<p>Despite its popularity as an index of diversity, Fisher’s <span class="math inline">\(\alpha\)</span> should not be applied to tropical forest communities because it is the parameter of a model that does not fit the data. According to the neutral theory, log-series communities would result from migration parameter 1, i.e.&nbsp;in the absence of dispersal limitation of the species of the metacommunity, which never occurs. Forcing the estimation of <span class="math inline">\(\alpha\)</span> in non-log-series distributions results in highly scale-dependent values that seriously question the comparisons between communities based on their <span class="math inline">\(\alpha\)</span> index.</p>
<p>At the regional scale, metacommunities do follow log-series distributions so <span class="math inline">\(\alpha\)</span> can be estimated from a set of scattered forest plots, even though the spatial structure of species may introduce estimation biases. Even ignoring this issue, <span class="math inline">\(\alpha\)</span> can’t be interpreted simply because it is not possible to characterize the area of the sampled metacommunity. At this scale, the measure is correct, but the measured object is unclear.</p>
<p>Finally, the empirical interest of Fisher’s <span class="math inline">\(\alpha\)</span> is limited to the distribution of clearly delimited metacommunities, such as the Amazon forest as a whole. In this context, it allowed among other results to estimate the number of tree species.</p>
<p>In contrast, species richness can be unambiguously defined and estimated at all scales. At the local scale, given the number of individuals, it contains the same information as <span class="math inline">\(\alpha\)</span> without assuming any particular distribution. It can be completed with other diversity metrics, namely Hill numbers <span class="citation" data-cites="Marcon2014a">(<a href="#ref-Marcon2014a" role="doc-biblioref">Marcon <em>et al.</em> 2014</a>)</span>. At the regional scale, with much more efforts, the number of species can be derived from Arrhenius’s power model with appropriate sampling <span class="citation" data-cites="Marcon2024">(<a href="#ref-Marcon2024" role="doc-biblioref">Marcon <em>et al.</em> 2024</a>)</span>.</p>
</section>


<section id="bibliography" class="level1 unnumbered">


</section>

<div id="quarto-appendix" class="default page-columns page-full"><section id="acknowledgement" class="level1 appendix" data-number="6"><h2 class="anchored quarto-appendix-heading"><span class="header-section-number">6</span> Acknowledgement</h2><div class="quarto-appendix-contents">

<p>The author thanks Jérôme Chave for discussions that motivated writing this article to explicit our disagreement about utilizing Fisher’s <span class="math inline">\(\alpha\)</span> as a diversity metric.</p>
</div></section><section id="appendix" class="level1 appendix" data-number="7"><h2 class="anchored quarto-appendix-heading"><span class="header-section-number">7</span> Appendix</h2><div class="quarto-appendix-contents">





</div></section><section id="sec-appendix1" class="level2 appendix" data-number="7.1"><h2 class="anchored quarto-appendix-heading"><span class="header-section-number">7.1</span> Estimating <span class="math inline">\(\alpha\)</span> with R</h2><div class="quarto-appendix-contents">




</div></section><section id="point-estimation" class="level3 appendix"><h2 class="anchored quarto-appendix-heading">Point estimation</h2><div class="quarto-appendix-contents">

<p>Most implementations of the calculation of <span class="math inline">\(\alpha\)</span> are limited to solving the equation</p>
<p><span class="math display">\[S(n) = \alpha \ln \left( 1 + \frac{n}{\alpha} \right),\]</span></p>
<p>where <span class="math inline">\(S(n)\)</span> is the number of species observed in a sample of size <span class="math inline">\(n\)</span>. The only data required are the total number of species and the sample size. The fifty hectares of BCI are used in the examples below.</p>
<p></p>
<p></p>
<p>Functions are:</p>
<ul>
<li><code>vegan::fisher.alpha()</code> that relies on <code>vegan::fisherfit()</code>. The numerical resolution uses <code>uniroot()</code>.</li>
</ul>
<p></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"vegan"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fisher.alpha</span>(BCI_50ha)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 35.05477</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fisherfit</span>(BCI_50ha)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Fisher log series model
No. of species: 225 
Fisher alpha:   35.05477 </code></pre>
</div>
</div>
<p></p>
<ul>
<li><code>untb::fishers.alpha()</code>, identical to <code>vegan::fisherfit()</code></li>
</ul>
<p></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"untb"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fishers.alpha</span>(<span class="at">N =</span> <span class="fu">sum</span>(BCI_50ha), <span class="at">S =</span> <span class="fu">sum</span>(BCI_50ha <span class="sc">&gt;</span> <span class="dv">0</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 35.05477</code></pre>
</div>
</div>
<p></p>
</div></section><section id="likelihood-maximisation" class="level3 appendix"><h2 class="anchored quarto-appendix-heading">Likelihood maximisation</h2><div class="quarto-appendix-contents">

<p>The alternative is to adjust the observed abundance distribution to the theoretical distribution of a log series, maximising its likelihood as a function of <span class="math inline">\(\alpha\)</span>.</p>
<p>This is done by <code>sads::fitls()</code> which uses <code>mle2()</code> to maximise the likelihood of <code>sads::dls()</code> (the probability density of the log-series). The default starting value is the point estimate.</p>
<p></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"sads"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fitls</span>(BCI_50ha) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>          N       alpha 
21457.00000    35.05477 </code></pre>
</div>
</div>
<p></p>
<p>In the case of BCI, the result is the same: the likelihood calculation gives predominant weight to the most abundant species.</p>
</div></section><section id="goodness-of-fit" class="level3 appendix page-columns page-full"><h2 class="anchored quarto-appendix-heading">Goodness of fit</h2><div class="quarto-appendix-contents page-columns page-full">

<p>The theoretical rank of a species <span class="math inline">\(r_s\)</span> can be calculated from its abundance <span class="math inline">\(n_s\)</span> <span class="citation" data-cites="May1975">(<a href="#ref-May1975" role="doc-biblioref">May 1975</a>)</span> with the following function <code>lseries_RAC</code>:</p>
<p><span class="math display">\[r_s = \alpha \int_{n_s \ln(1 + \alpha / n)}^\infty{\frac{e^{-t}}{t} dt}\]</span></p>
<p>It is a real value, not an integer.</p>
<p></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Theoretical rank of abundances</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param abd a vector of abundances</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param alpha Fisher's alpha of the distribution</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @returns a vector of ranks</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>lseries_RAC <span class="ot">&lt;-</span> <span class="cf">function</span>(abd, alpha) {</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">sum</span>(abd)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  rank <span class="ot">&lt;-</span> <span class="fu">vapply</span>(</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the rank of each species</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    abd, </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">FUN =</span> <span class="cf">function</span>(n_s) {</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate the integral</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>      f <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">integrate</span>(</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(t) {<span class="fu">exp</span>(<span class="sc">-</span>t) <span class="sc">/</span> t}, </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> n_s <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">+</span> alpha <span class="sc">/</span> n), </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="cn">Inf</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Multiply it by alpha</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>      alpha <span class="sc">*</span> f[[<span class="st">"value"</span>]]</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    }, </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">FUN.VALUE =</span> <span class="dv">0</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the RAC as a tibble</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(rank, <span class="at">abundance =</span> abd) <span class="sc">|&gt;</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(rank)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p></p>
<p>The best-fit value of <span class="math inline">\(\alpha\)</span> can be found by minimizing the sum of the absolute differences between theoretical and observed ranks.</p>
<p></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Fit alpha by minimizing the departure of species </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' ranks from their theoretical value in a log-series</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param abd a vector of abundances</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @returns the best-fit value of of Fisher's alpha</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>fit_alpha <span class="ot">&lt;-</span> <span class="cf">function</span>(abd) {</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  abd_decr <span class="ot">&lt;-</span> <span class="fu">sort</span>(abd[abd <span class="sc">&gt;</span> <span class="dv">0</span>], <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  optimized <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">optim</span>(</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">par =</span> vegan<span class="sc">::</span><span class="fu">fisher.alpha</span>(abd),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fn =</span> <span class="cf">function</span>(alpha) {</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(<span class="fu">abs</span>(<span class="fu">seq_along</span>(abd_decr) </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="sc">-</span> <span class="fu">lseries_RAC</span>(abd_decr, alpha)<span class="sc">$</span>rank))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    }, </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="dv">0</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  optimized<span class="sc">$</span>par</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p></p>
<p>Applied to BCI, the estimate of <span class="math inline">\(\alpha\)</span> is 42.</p>
<p></p>
<p></p>
<div id="fig-bci_alpha_gof" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-bci_alpha_gof-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/bci_alpha_gof-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p></p>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-bci_alpha_gof-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Rank-Abundance Curve (RAC) of BCI (red points) and of the best-fit log-series (black line).
</figcaption>
</figure>
</div>
</div></section><section id="sec-appendix2" class="level2 appendix page-columns page-full" data-number="7.2"><h2 class="anchored quarto-appendix-heading"><span class="header-section-number">7.2</span> Estimating <span class="math inline">\(\theta\)</span> by the abundant species distribution</h2><div class="quarto-appendix-contents page-columns page-full">

<p><span class="citation" data-cites="Hubbell2001">Hubbell (<a href="#ref-Hubbell2001" role="doc-biblioref">2001</a>)</span> proposes estimating <span class="math inline">\(\theta\)</span> by adjusting the rank-abundance curve to the most frequent species in the community, arguing that these species are also the most abundant in the metacommunity.</p>
<p></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>BCI_50ha <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(. <span class="sc">&gt;</span> <span class="fu">median</span>(.)) <span class="ot">-&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  BCI_abundant</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>BCI_theta <span class="ot">&lt;-</span> <span class="fu">fit_alpha</span>(BCI_abundant)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"divent"</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>BCI_abundant <span class="sc">%&gt;%</span> </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_abundances</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">lseries_RAC</span>(BCI_50ha, <span class="at">alpha =</span> BCI_theta),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> rank, <span class="at">y =</span> abundance)    </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="ot">-&gt;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  fig_hubbell_alpha</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p></p>
<div id="fig-hubbell_alpha" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-hubbell_alpha-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/hubbell_alpha-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p></p>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-hubbell_alpha-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Estimation of <span class="math inline">\(\theta\)</span> at BCI based on the best fit of <span class="math inline">\(\alpha\)</span>, assuming the half most abundant species are distributed as a log-series. The rank-abundance curve of the data (red points) and of the inferred log-series (black line) are shown.
</figcaption>
</figure>
</div>
<p>The estimate using Hubbell’s method is 45. The good fit of this estimation is shown on <a href="#fig-hubbell_alpha" class="quarto-xref">Figure&nbsp;7</a>.</p>
</div></section><section id="sec-appendix3" class="level2 appendix page-columns page-full" data-number="7.3"><h2 class="anchored quarto-appendix-heading"><span class="header-section-number">7.3</span> Full simulation</h2><div class="quarto-appendix-contents page-columns page-full">

<p>The objective is to close the loop: using the parameters obtained from the BCI data, simulate a metacommunity and then a community of the same size as BCI. To validate the approach, the simulated distribution should be similar to the actual one.</p>
<p>BCI parameters <span class="math inline">\(\theta\)</span> and <span class="math inline">\(m\)</span> are estimated following <span class="citation" data-cites="Etienne2005">Etienne (<a href="#ref-Etienne2005" role="doc-biblioref">2005</a>)</span> with the untb package.</p>
<p></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"untb"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(<span class="st">"data/BCI_logkda.RData"</span>)) {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use the saved result if available to save</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># computation resources</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">"data/BCI_logkda.RData"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  BCI_50ha <span class="sc">%&gt;%</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># name conflict with dplyr::count()</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  untb<span class="sc">::</span><span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># requires pari/gp installed and in the search paths,</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># or use gp_binary argument</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logkda</span>() <span class="ot">-&gt;</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  BCI_logkda</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save the result</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(BCI_logkda, <span class="at">file =</span> <span class="st">"data/BCI_logkda.RData"</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>BCI_50ha <span class="sc">%&gt;%</span> </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># name conflict with dplyr::count()</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  untb<span class="sc">::</span><span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Estimate theta and m</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">optimal.params</span>(<span class="at">log.kda =</span> BCI_logkda) <span class="sc">%&gt;%</span> </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>() <span class="ot">-&gt;</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  BCI_params</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     theta          m 
47.6001882  0.0926531 </code></pre>
</div>
</div>
<p></p>
<p>A metacommunity with <span class="math inline">\(J_m = 10^6\)</span> (arbitrary) and <span class="math inline">\(\theta\)</span> derived from BCI data is simulated.</p>
<p></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>J_m <span class="ot">&lt;-</span> <span class="fl">1E6</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> BCI_params[<span class="dv">1</span>]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"divent"</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>the_metacommunity <span class="ot">&lt;-</span> <span class="fu">rcommunity</span>(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> J_m , </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">distribution =</span> <span class="st">"lseries"</span>, </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">fisher_alpha =</span> theta</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p></p>
<p>The distribution of the local community is derived. <span class="math inline">\(J\)</span> is that of BCI and <span class="math inline">\(m\)</span> was estimated previously, compared to an arbitrary value of <span class="math inline">\(m\)</span>.</p>
<p></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>J <span class="ot">&lt;-</span> <span class="fu">sum</span>(BCI)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> BCI_params[<span class="dv">2</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"sads"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of species in the local community</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">Svolkov</span>(theta, m, J) <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Must be integers for the simulation</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Draw the species abundances</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rvolkov</span>(theta, m, J) <span class="sc">%&gt;%</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make it an abundances object top plot it</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_abundances</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Whittaker plot</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="ot">-&gt;</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  BCI_sim_neutral</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># BCI real distribution</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>BCI_50ha <span class="sc">%&gt;%</span> </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">seq_len</span>(<span class="fu">n</span>())) <span class="ot">-&gt;</span> </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  BCI_tbl_50ha</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare with m = 1%</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>m_arbitrary <span class="ot">&lt;-</span> .<span class="dv">01</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="fu">Svolkov</span>(theta, m_arbitrary, J) <span class="sc">%&gt;%</span> </span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Must be integers for the simulation</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Draw the species abundances</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rvolkov</span>(theta, m, J) <span class="sc">%&gt;%</span> </span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">seq_len</span>(<span class="fu">n</span>())) <span class="ot">-&gt;</span> </span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>  BCI_tbl_m001</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot altogether</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>BCI_sim_neutral <span class="sc">+</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> BCI_tbl_50ha,</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> rank, <span class="at">y =</span> value)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> BCI_tbl_m001,</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> rank, <span class="at">y =</span> value),</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"blue"</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="ot">-&gt;</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>  fig_bci_sim</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p></p>
<div id="fig-bci_sim" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-bci_sim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/bci_sim-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p></p>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-bci_sim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: RAC of BCI compared to two simulated distributions. The simulated zero-sum multinomial distribution (red dots) simulated with the <span class="math inline">\(\theta\)</span> and <span class="math inline">\(m\)</span> parameters derived from the data corresponds fairly well to the actual distribution of BCI (black line). The blue dots are a distribution simulated with BCI’s <span class="math inline">\(\theta\)</span> but a migration parameter reduced to 0.01 to illustrate that the same values of <span class="math inline">\(\theta\)</span> correspond to very different communities. Both <span class="math inline">\(\theta\)</span> and <span class="math inline">\(m\)</span> must be considered to describe the diversity.
</figcaption>
</figure>
</div>
<p><a href="#fig-bci_sim" class="quarto-xref">Figure&nbsp;8</a> shows that the simulated community is very similar to the real one but that modifying the migration parameter results in a very different distribution: <span class="math inline">\(\theta\)</span> alone does not give much information on the local community.</p>
</div></section><section id="sec-appendix4" class="level2 appendix page-columns page-full" data-number="7.4"><h2 class="anchored quarto-appendix-heading"><span class="header-section-number">7.4</span> Increasing regional sampling</h2><div class="quarto-appendix-contents page-columns page-full">

<p>An increasing number of GuyaDiv plots (one per site) is randomly selected to sample the metacommunity. The estimated <span class="math inline">\(\alpha\)</span> is plotted against the number of plots (<a href="#fig-guyadiv_alpha" class="quarto-xref">Figure&nbsp;9</a>). It increases with the logarithm of the number of plots that is a proxy of the size of the sampled metacommunity.</p>
<p></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to randomly select a plot in each of a</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># chosen number of sites (sample_size), </span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># merge the plots and return alpha.</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>guyadiv_sub_alpha <span class="ot">&lt;-</span> <span class="cf">function</span>(sample_size) {</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select one plot per location...</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  guyadiv_plots <span class="sc">%&gt;%</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set a random value to each plot</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">random =</span> <span class="fu">runif</span>(<span class="fu">n</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save the tibble</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    {. <span class="ot">-&gt;&gt;</span> plots_randomized} <span class="sc">%&gt;%</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select the plot with the max random value </span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># in each location</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Location) <span class="sc">%&gt;%</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">random_max =</span> <span class="fu">max</span>(random)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">random =</span> random_max) <span class="sc">%&gt;%</span> </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Eliminate non-selected plots</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(plots_randomized) <span class="sc">%&gt;%</span> </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep the plot number and the random number</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(Plot, random) <span class="sc">%&gt;%</span> </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the abundances</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(guyadiv_abd) <span class="sc">%&gt;%</span> </span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by random number</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(random) <span class="sc">%&gt;%</span> </span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep the first rows</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(sample_size) <span class="sc">%&gt;%</span> </span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Delete the random numbers</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>random) <span class="sc">%&gt;%</span> </span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make the table an abundance object (divent)</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">site =</span> Plot) <span class="sc">%&gt;%</span> </span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_abundances</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Give all plots equal weight</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">weight =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge the inventories</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">metacommunity</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract a numeric vector</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute alpha</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fisher.alpha</span>()</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of sites</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>guyadiv_plots <span class="sc">%&gt;%</span> </span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Location) <span class="sc">%&gt;%</span> </span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>() <span class="ot">-&gt;</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>  sites_n</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose sizes between 3 and the number of sites</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>sizes <span class="ot">&lt;-</span> <span class="fu">seq_len</span>(sites_n)[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)]</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate alpha of each sample</span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>alphas <span class="ot">&lt;-</span> <span class="fu">replicate</span>(</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>  simulations_n,</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span> <span class="fu">sapply</span>(sizes, <span class="at">FUN =</span> guyadiv_sub_alpha)</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">NbPlots =</span> sizes) <span class="sc">%&gt;%</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(alphas) <span class="sc">%&gt;%</span> </span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">!</span>NbPlots) <span class="sc">%&gt;%</span> </span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> NbPlots, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Number of Plots"</span>, <span class="at">y =</span> <span class="st">"Fisher's alpha"</span>) <span class="sc">+</span></span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">2</span>)) <span class="ot">-&gt;</span></span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>  fig_guyadiv_alpha</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p></p>
<div id="fig-guyadiv_alpha" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-guyadiv_alpha-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/guyadiv_alpha-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p></p>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-guyadiv_alpha-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Estimation of the metacommunity’s <span class="math inline">\(\alpha\)</span> as a function of the number of GuyaDiv plots used to sample it. The line is the fit of the quadratic model relating <span class="math inline">\(\alpha\)</span> to the logarithm of the number of plots.
</figcaption>
</figure>
</div>
</div></section><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Arrhenius1921" class="csl-entry" role="listitem">
Arrhenius, O. (1921). <a href="https://doi.org/10.2307/2255763">Species and area</a>. <em>Journal of Ecology</em>, 9, 95–99.
</div>
<div id="ref-Burnham1978" class="csl-entry" role="listitem">
Burnham, K.P. &amp; Overton, W.S. (1978). <a href="https://doi.org/10.2307/2335915">Estimation of the size of a closed population when capture probabilities vary among animals</a>. <em>Biometrika</em>, 65, 625–633.
</div>
<div id="ref-Chao2014" class="csl-entry" role="listitem">
Chao, A., Gotelli, N.J., Hsieh, T.C., Sander, E.L., Ma, K.H., Colwell, R.K., <em>et al.</em> (2014). <a href="https://doi.org/10.1890/13-0133.1">Rarefaction and extrapolation with hill numbers: A framework for sampling and estimation in species diversity studies</a>. <em>Ecological Monographs</em>, 84, 45–67.
</div>
<div id="ref-Chao2012b" class="csl-entry" role="listitem">
Chao, A. &amp; Jost, L. (2012). <a href="https://doi.org/10.1890/11-1952.1">Coverage-based rarefaction and extrapolation: Standardizing samples by completeness rather than size</a>. <em>Ecology</em>, 93, 2533–2547.
</div>
<div id="ref-Condit2002" class="csl-entry" role="listitem">
Condit, R., Pitman, N., Leigh, E.G.J., Chave, J., Terborgh, J., Foster, R.B., <em>et al.</em> (2002). <a href="https://doi.org/10.1126/science.1066854">Beta-diversity in tropical forest trees</a>. <em>Science</em>, 295, 666–669.
</div>
<div id="ref-Dengler2009" class="csl-entry" role="listitem">
Dengler, J. (2009). <a href="https://doi.org/10.1111/j.1365-2699.2008.02038.x">Which function describes the species-area relationship best? A review and empirical evaluation</a>. <em>Journal of Biogeography</em>, 36, 728–744.
</div>
<div id="ref-Duque2017" class="csl-entry" role="listitem">
Duque, A., Muller-Landau, H.C., Valencia, R., Cardenas, D., Davies, S., De Oliveira, A., <em>et al.</em> (2017). <a href="https://doi.org/10.1007/s10531-016-1265-9">Insights into regional patterns of amazonian forest structure, diversity, and dominance from three large terra-firme forest dynamics plots</a>. <em>Biodiversity and Conservation</em>, 26, 669–686.
</div>
<div id="ref-Engel2015" class="csl-entry" role="listitem">
Engel, J. (2015). <a href="http://atdnmorphospecies.myspecies.info/node/781">Plot networks &amp; teams</a>. <em>ATDN tree morphospecies website</em>.
</div>
<div id="ref-Engen1977" class="csl-entry" role="listitem">
Engen, S. (1977). Exponential and logarithmic species-area curves. <em>The American Naturalist</em>, 111, 591–594.
</div>
<div id="ref-Etienne2005" class="csl-entry" role="listitem">
Etienne, R.S. (2005). <a href="https://doi.org/10.1111/j.1461-0248.2004.00717.x">A new sampling formula for neutral biodiversity</a>. <em>Ecology Letters</em>, 8, 253–260.
</div>
<div id="ref-Fisher1943" class="csl-entry" role="listitem">
Fisher, R.A., Corbet, A.S. &amp; Williams, C.B. (1943). <a href="https://doi.org/10.2307/1411">The relation between the number of species and the number of individuals in a random sample of an animal population</a>. <em>Journal of Animal Ecology</em>, 12, 42–58.
</div>
<div id="ref-Gleason1922" class="csl-entry" role="listitem">
Gleason, H.A. (1922). <a href="https://doi.org/10.2307/1929150">On the relation between species and area</a>. <em>Ecology</em>, 3, 158–162.
</div>
<div id="ref-Gotelli2001" class="csl-entry" role="listitem">
Gotelli, N.J. &amp; Colwell, R.K. (2001). <a href="https://doi.org/10.1046/j.1461-0248.2001.00230.x">Quantifying biodiversity: Procedures and pitfalls in the measurement and comparison of species richness</a>. <em>Ecology Letters</em>, 4, 379–391.
</div>
<div id="ref-Grabchak2016" class="csl-entry" role="listitem">
Grabchak, M., Marcon, E., Lang, G. &amp; Zhang, Z. (2017). <a href="https://doi.org/10.1371/journal.pone.0173305">The generalized simpson’s entropy is a measure of biodiversity</a>. <em>Plos One</em>, 12, e0173305.
</div>
<div id="ref-Grilli2012" class="csl-entry" role="listitem">
Grilli, J., Azaele, S., Banavar, J.R. &amp; Maritan, A. (2012). <a href="https://doi.org/10.1016/j.jtbi.2012.07.030">Spatial aggregation and the species-area relationship across scales</a>. <em>Journal of Theoretical Biology</em>, 313, 87–97.
</div>
<div id="ref-Hankin2007" class="csl-entry" role="listitem">
Hankin, R.K.S. (2007). <a href="https://doi.org/10.18637/jss.v022.i12">Introducing untb, an r package for simulating ecological drift under the unified neutral theory of biodiversity</a>. <em>Journal of Statistical Software</em>, 22, 1–15.
</div>
<div id="ref-Harte1999" class="csl-entry" role="listitem">
Harte, J., Kinzig, A. &amp; Green, J. (1999). <a href="https://doi.org/10.1126/science.284.5412.334">Self-similarity in the distribution and abundance of species</a>. <em>Science</em>, 284, 334–336.
</div>
<div id="ref-Hubbell2001" class="csl-entry" role="listitem">
Hubbell, S.P. (2001). <em>The unified neutral theory of biodiversity and biogeography</em>. Princeton University Press.
</div>
<div id="ref-Liang2016" class="csl-entry" role="listitem">
Liang, J., Crowther, T.W., Picard, N., Wiser, S., Zhou, M., Alberti, G., <em>et al.</em> (2016). <a href="https://doi.org/10.1126/science.aaf8957">Positive biodiversity-productivity relationship predominant in global forests</a>. <em>Science</em>, 354, aaf8957.
</div>
<div id="ref-MacArthur1967" class="csl-entry" role="listitem">
MacArthur, R.H. &amp; Wilson, E.O. (1967). <em>The theory of island biogeography</em>. Monographs in population biology. Princeton University Press.
</div>
<div id="ref-Marcon2024" class="csl-entry" role="listitem">
Marcon, E., Mirabel, A., Molino, J.-F. &amp; Sabatier, D. (2024). <a href="https://doi.org/10.1017/S0266467424000099">Estimation of the number of tree species in french guiana by extrapolation of permanent plots richness</a>. <em>Journal of Tropical Ecology</em>, 40, e11.
</div>
<div id="ref-Marcon2014a" class="csl-entry" role="listitem">
Marcon, E., Scotti, I., Hérault, B., Rossi, V. &amp; Lang, G. (2014). <a href="https://doi.org/10.1371/journal.pone.0090289">Generalization of the partitioning of shannon diversity</a>. <em>Plos One</em>, 9, e90289.
</div>
<div id="ref-May1975" class="csl-entry" role="listitem">
May, R.M. (1975). Patterns of species abundance and diversity. In: <em>Ecology and evolution of communities</em> (eds. Cody, M.L. &amp; Diamond, J.M.). Harvard University Press, pp. 81–120.
</div>
<div id="ref-McGill2003" class="csl-entry" role="listitem">
McGill, B.J. (2003). <a href="https://doi.org/10.1038/nature01583">A test of the unified neutral theory of biodiversity</a>. <em>Nature</em>, 422, 881–885.
</div>
<div id="ref-Milton2025" class="csl-entry" role="listitem">
Milton, T.F. &amp; Ostling, A. (2025). <a href="https://doi.org/10.1111/1365-2745.70174">Amazonian hyperdominance exceeds expectations of neutral theory</a>. <em>Journal of Ecology</em>, 1365–2745.70174.
</div>
<div id="ref-Muller-Landau2024" class="csl-entry" role="listitem">
Muller-Landau, H.C. &amp; Wright, S.J. (2024). <em><a href="https://doi.org/10.5479/si.26048527">The first 100 years of research on barro colorado: Plant and ecosystem science (volumes 1 and 2)</a></em>. Smithsonian Institution Scholarly Press.
</div>
<div id="ref-vegan" class="csl-entry" role="listitem">
Oksanen, J., Simpson, G.L., Blanchet, F.G., Kindt, R., Legendre, P., Minchin, P.R., <em>et al.</em> (2025). <em><a href="https://doi.org/10.32614/CRAN.package.vegan">Vegan: Community ecology package</a></em>.
</div>
<div id="ref-Patil1982" class="csl-entry" role="listitem">
Patil, G.P. &amp; Taillie, C. (1982). <a href="https://doi.org/10.2307/2287709">Diversity as a concept and its measurement</a>. <em>Journal of the American Statistical Association</em>, 77, 548–561.
</div>
<div id="ref-Plotkin2000a" class="csl-entry" role="listitem">
Plotkin, J.B., Potts, M.D., Leslie, N., Manokaran, N., LaFrankie, J.V. &amp; Ashton, P.S. (2000). <a href="https://doi.org/10.1006/jtbi.2000.2158">Species-area curves, spatial aggregation, and habitat specialization in tropical forests</a>. <em>Journal of Theoretical Biology</em>, 207, 81–99.
</div>
<div id="ref-Preston1962" class="csl-entry" role="listitem">
Preston, F.W. (1962). <a href="https://doi.org/10.2307/1931976">The canonical distribution of commonness and rarity: Part i</a>. <em>Ecology</em>, 43, 185–215.
</div>
<div id="ref-R" class="csl-entry" role="listitem">
R Core Team. (2025). <em><a href="http://www.r-project.org">R: A language and environment for statistical computing</a></em>. R Foundation for Statistical Computing.
</div>
<div id="ref-Schulte2005" class="csl-entry" role="listitem">
Schulte, R.P.O., Lantinga, E.A. &amp; Hawkins, M.J. (2005). <a href="https://doi.org/10.1016/j.jtbi.2004.08.014">A new family of fisher-curves estimates fisher’s alpha more accurately</a>. <em>Journal of Theoretical Biology</em>, 232, 305–313.
</div>
<div id="ref-Slik2015" class="csl-entry" role="listitem">
Slik, J.W.F., Arroyo-Rodríguez, V., Aiba, S.-I., Alvarez-Loayza, P., Alves, L.F., Ashton, P.S., <em>et al.</em> (2015). <a href="https://doi.org/10.1073/pnas.1423147112">An estimate of the number of tropical tree species</a>. <em>Proceedings of the National Academy of Sciences of the United States of America</em>, 112, 7472–7477.
</div>
<div id="ref-TerSteege2013" class="csl-entry" role="listitem">
Steege, H. ter, Pitman, N.C.A., Sabatier, D., Baraloto, C., Salomão, R.P., Guevara, J.E., <em>et al.</em> (2013). <a href="https://doi.org/10.1126/science.1243092">Hyperdominance in the amazonian tree flora</a>. <em>Science</em>, 342, 1243092.
</div>
<div id="ref-TerSteege2020" class="csl-entry" role="listitem">
Steege, H. ter, Prado, P.I., Lima, R.A.F. de, Pos, E., Souza Coelho, L. de, Andrade Lima Filho, D. de, <em>et al.</em> (2020). <a href="https://doi.org/10.1038/s41598-020-66686-3">Biased-corrected richness estimates for the amazonian tree flora</a>. <em>Scientific Reports</em>, 10, 10130.
</div>
<div id="ref-Strange2024" class="csl-entry" role="listitem">
Strange, N., Ermgassen, S.Z., Marshall, E., Bull, J.W. &amp; Jacobsen, J.B. (2024). <a href="https://doi.org/10.1016/j.biocon.2024.110546">Why it matters how biodiversity is measured in environmental valuation studies compared to conservation science</a>. <em>Biological Conservation</em>, 292, 110546.
</div>
<div id="ref-Stroud2015" class="csl-entry" role="listitem">
Stroud, J.T., Bush, M.R., Ladd, M.C., Nowicki, R.J., Shantz, A.A. &amp; Sweatman, J. (2015). <a href="https://doi.org/10.1002/ece3.1651">Is a community still a community? Reviewing definitions of key terms in community ecology</a>. <em>Ecology and Evolution</em>, 5, 4757–4765.
</div>
<div id="ref-TerSteege2023" class="csl-entry" role="listitem">
Ter Steege, H., Pitman, N.C.A., Do Amaral, I.L., De Souza Coelho, L., De Almeida Matos, F.D., De Andrade Lima Filho, D., <em>et al.</em> (2023). <a href="https://doi.org/10.1038/s42003-023-05514-6">Mapping density, diversity and species-richness of the amazon tree flora</a>. <em>Communications Biology</em>, 6, 1130.
</div>
<div id="ref-Tothmeresz1995" class="csl-entry" role="listitem">
Tothmeresz, B. (1995). <a href="https://doi.org/10.2307/3236223">Comparison of different methods for diversity ordering</a>. <em>Journal of Vegetation Science</em>, 6, 283–290.
</div>
<div id="ref-Triantis2012" class="csl-entry" role="listitem">
Triantis, K.A., Guilhaumon, F. &amp; Whittaker, R.J. (2012). <a href="https://doi.org/10.1111/j.1365-2699.2011.02652.x">The island species-area relationship: Biology and statistics</a>. <em>Journal of Biogeography</em>, 39, 215–231.
</div>
<div id="ref-Valencia1994" class="csl-entry" role="listitem">
Valencia, R., Balslev, H. &amp; Paz Y Miño C, G. (1994). <a href="https://doi.org/10.1007/BF00115330">High tree alpha-diversity in amazonian ecuador</a>. <em>Biodiversity and Conservation</em>, 3, 21–28.
</div>
<div id="ref-Volkov2003" class="csl-entry" role="listitem">
Volkov, I., Banavar, J.R., Hubbell, S.P. &amp; Maritan, A. (2003). <a href="https://doi.org/10.1038/nature01883">Neutral theory and relative species abundance in ecology</a>. <em>Nature</em>, 424, 1035–1037.
</div>
<div id="ref-Whittaker1960" class="csl-entry" role="listitem">
Whittaker, R.H. (1960). <a href="https://doi.org/10.2307/1943563">Vegetation of the siskiyou mountains, oregon and california</a>. <em>Ecological Monographs</em>, 30, 279–338.
</div>
<div id="ref-Williamson2001" class="csl-entry" role="listitem">
Williamson, M., Gaston, K.J. &amp; Lonsdale, W.M. (2001). <a href="https://doi.org/10.1046/j.1365-2699.2001.00603.x">The species-area relationship does not have an asymptote!</a> <em>Journal of Biogeography</em>, 28, 827–830.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>